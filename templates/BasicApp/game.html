<!DOCTYPE html>
{% load staticfiles %}
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <title>GamePage</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static "BasicApp/css/indexPage.css" %}"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
      (function(){
        emailjs.init("user_UnwLtHuXDI1h8kj3fKQbx");
      })();
    </script>
  </head>

  <body>

    <!--Navigation Bar Section-->
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Psulu-HAL</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
            <li><a href="{% url 'index'%}">Home</a></li>
            <li><a href="{% url 'about'%}">About</a></li>
            <li><a href="{% url 'mapLibrary'%}">Map Library</a></li>
            <li class = "active"><a href="{% url 'game'%}">Software</a></li>
            <li><a href="{% url 'contact'%}">Contact</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="{% url 'admin:index'%}"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!--Introduction-->
    <div class = "jumbotron">

      <div class = "container">
        <div class = "row content">
          <!--Map Generation-->
          <div class = "col-sm-4">
            <label for="startButton">Step 1: Enter Participant ID</label>
            <button type="button" id = "startButton" class="btn btn-warning btn-lg" onclick="startButtonClicked()">Enter Participant ID</button>
            <br></br>
            <label>Step 2: Choose mode and a map</label>
            <div class="btn-group" data-toggle="buttons">
              <label class="btn btn-primary btn-lg">
              <input type="radio" name="options" data-id="default_mode" id="default_mode_radio_button"> Map Library
              </label>

              <label class="btn btn-primary btn-lg">
              <input type="radio" name="options" data-id="play_mode" id="play_mode_radio_button"> Random Map
              </label>
            </div>
            <br>
            <small class="form-text text-muted">For more info about maps, please refer the "Map Library" Webpage</small>
            <br></br>


            <div id = "play_mode">
            <div class="form-group">
              <label for="sel1">Select the obstacle number to randomly generate:</label>
              <select class="form-control" id="obstalce_nums">
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
                <option>11</option>
                <option>12</option>
                <option>13</option>
                <option>14</option>
                <option>15</option>
                <option>16</option>
                <option>17</option>
                <option>18</option>
                <option>19</option>
                <option>20</option>
              </select>
              <small class="form-text text-muted">Generation will restart game</small>
              <br>
              <button type="button" id="changeMapinRandomMode" class="btn btn-info btn-lg" onclick="changeMap(document.getElementById('obstalce_nums').value)">Generate</button>
            </div>
            </div>

            <div id = "default_mode">
            <div class="form-group">
              <label for="sel1">Default Experiment Mode:</label>
              <select class="form-control" id="default_maps_level1">
                <option value = "5">5 Obstacles</option>
                <option value = "6">6 Obstacles</option>
                <option value = "7">7 Obstacles</option>
                <option value = "8">8 Obstacles</option>
                <option value = "9">9 Obstacles</option>
                <option value = "10">10 Obstacles</option>
                <option value = "11">11 Obstacles</option>
                <option value = "12">12 Obstacles</option>
                <option value = "13">13 Obstacles</option>
                <option value = "14">14 Obstacles</option>
                <option value = "15">15 Obstacles</option>
                <option value = "16">16 Obstacles</option>
                <option value = "17">17 Obstacles</option>
                <option value = "18">18 Obstacles</option>
                <option value = "19">19 Obstacles</option>
                <option value = "20">20 Obstacles</option>
              </select>

              <select multiple class="form-control" id="default_maps_level2">
                <option value = "5">obs5_01</option>
                <option value = "5">obs5_02</option>
                <option value = "5">obs5_03</option>
                <option value = "5">obs5_04</option>
                <option value = "5">obs5_05</option>
                <option value = "5">obs5_06</option>
                <option value = "5">obs5_07</option>
                <option value = "5">obs5_08</option>
                <option value = "5">obs5_09</option>
                <option value = "5">obs5_10</option>
                <option value = "6">obs6_01</option>
                <option value = "6">obs6_02</option>
                <option value = "6">obs6_03</option>
                <option value = "6">obs6_04</option>
                <option value = "6">obs6_05</option>
                <option value = "6">obs6_06</option>
                <option value = "6">obs6_07</option>
                <option value = "6">obs6_08</option>
                <option value = "6">obs6_09</option>
                <option value = "6">obs6_10</option>
                <option value = "7">obs7_01</option>
                <option value = "7">obs7_02</option>
                <option value = "7">obs7_03</option>
                <option value = "7">obs7_04</option>
                <option value = "7">obs7_05</option>
                <option value = "7">obs7_06</option>
                <option value = "7">obs7_07</option>
                <option value = "7">obs7_08</option>
                <option value = "7">obs7_09</option>
                <option value = "7">obs7_10</option>
                <option value = "8">obs8_01</option>
                <option value = "8">obs8_02</option>
                <option value = "8">obs8_03</option>
                <option value = "8">obs8_04</option>
                <option value = "8">obs8_05</option>
                <option value = "8">obs8_06</option>
                <option value = "8">obs8_07</option>
                <option value = "8">obs8_08</option>
                <option value = "8">obs8_09</option>
                <option value = "8">obs8_10</option>
                <option value = "9">obs9_01</option>
                <option value = "9">obs9_02</option>
                <option value = "9">obs9_03</option>
                <option value = "9">obs9_04</option>
                <option value = "9">obs9_05</option>
                <option value = "9">obs9_06</option>
                <option value = "9">obs9_07</option>
                <option value = "9">obs9_08</option>
                <option value = "9">obs9_09</option>
                <option value = "9">obs9_10</option>
                <option value = "10">obs10_01</option>
                <option value = "10">obs10_02</option>
                <option value = "10">obs10_03</option>
                <option value = "10">obs10_04</option>
                <option value = "10">obs10_05</option>
                <option value = "10">obs10_06</option>
                <option value = "10">obs10_07</option>
                <option value = "10">obs10_08</option>
                <option value = "10">obs10_09</option>
                <option value = "10">obs10_10</option>
                <option value = "11">obs11_01</option>
                <option value = "11">obs11_02</option>
                <option value = "11">obs11_03</option>
                <option value = "11">obs11_04</option>
                <option value = "11">obs11_05</option>
                <option value = "11">obs11_06</option>
                <option value = "11">obs11_07</option>
                <option value = "11">obs11_08</option>
                <option value = "11">obs11_09</option>
                <option value = "11">obs11_10</option>
                <option value = "12">obs12_01</option>
                <option value = "12">obs12_02</option>
                <option value = "12">obs12_03</option>
                <option value = "12">obs12_04</option>
                <option value = "12">obs12_05</option>
                <option value = "12">obs12_06</option>
                <option value = "12">obs12_07</option>
                <option value = "12">obs12_08</option>
                <option value = "12">obs12_09</option>
                <option value = "12">obs12_10</option>
                <option value = "13">obs13_01</option>
                <option value = "13">obs13_02</option>
                <option value = "13">obs13_03</option>
                <option value = "13">obs13_04</option>
                <option value = "13">obs13_05</option>
                <option value = "13">obs13_06</option>
                <option value = "13">obs13_07</option>
                <option value = "13">obs13_08</option>
                <option value = "13">obs13_09</option>
                <option value = "13">obs13_10</option>
                <option value = "14">obs14_01</option>
                <option value = "14">obs14_02</option>
                <option value = "14">obs14_03</option>
                <option value = "14">obs14_04</option>
                <option value = "14">obs14_05</option>
                <option value = "14">obs14_06</option>
                <option value = "14">obs14_07</option>
                <option value = "14">obs14_08</option>
                <option value = "14">obs14_09</option>
                <option value = "14">obs14_10</option>
                <option value = "15">obs15_01</option>
                <option value = "15">obs15_02</option>
                <option value = "15">obs15_03</option>
                <option value = "15">obs15_04</option>
                <option value = "15">obs15_05</option>
                <option value = "15">obs15_06</option>
                <option value = "15">obs15_07</option>
                <option value = "15">obs15_08</option>
                <option value = "15">obs15_09</option>
                <option value = "15">obs15_10</option>
                <option value = "16">obs16_01</option>
                <option value = "16">obs16_02</option>
                <option value = "16">obs16_03</option>
                <option value = "16">obs16_04</option>
                <option value = "16">obs16_05</option>
                <option value = "16">obs16_06</option>
                <option value = "16">obs16_07</option>
                <option value = "16">obs16_08</option>
                <option value = "16">obs16_09</option>
                <option value = "16">obs16_10</option>
                <option value = "17">obs17_01</option>
                <option value = "17">obs17_02</option>
                <option value = "17">obs17_03</option>
                <option value = "17">obs17_04</option>
                <option value = "17">obs17_05</option>
                <option value = "17">obs17_06</option>
                <option value = "17">obs17_07</option>
                <option value = "17">obs17_08</option>
                <option value = "17">obs17_09</option>
                <option value = "17">obs17_10</option>
                <option value = "18">obs18_01</option>
                <option value = "18">obs18_02</option>
                <option value = "18">obs18_03</option>
                <option value = "18">obs18_04</option>
                <option value = "18">obs18_05</option>
                <option value = "18">obs18_06</option>
                <option value = "18">obs18_07</option>
                <option value = "18">obs18_08</option>
                <option value = "18">obs18_09</option>
                <option value = "18">obs18_10</option>
                <option value = "19">obs19_01</option>
                <option value = "19">obs19_02</option>
                <option value = "19">obs19_03</option>
                <option value = "19">obs19_04</option>
                <option value = "19">obs19_05</option>
                <option value = "19">obs19_06</option>
                <option value = "19">obs19_07</option>
                <option value = "19">obs19_08</option>
                <option value = "19">obs19_09</option>
                <option value = "19">obs19_10</option>
                <option value = "20">obs20_01</option>
                <option value = "20">obs20_02</option>
                <option value = "20">obs20_03</option>
                <option value = "20">obs20_04</option>
                <option value = "20">obs20_05</option>
                <option value = "20">obs20_06</option>
                <option value = "20">obs20_07</option>
                <option value = "20">obs20_08</option>
                <option value = "20">obs20_09</option>
                <option value = "20">obs20_10</option>
              </select>
              <small class="form-text text-muted">Select a map for experiment</small>
              <br>
              <button type="button" id="changeMapinExpMode" class="btn btn-info btn-lg" onclick = "applyExpMap()">Apply</button>
            </div>
            </div>

          </div>
          <script>
          $('#default_maps_level1').change(function() {
            if ($(this).data('options') === undefined) {
              $(this).data('options', $('#default_maps_level2 option').clone());
            }
            var id = $(this).val();
            var options = $(this).data('options').filter('[value=' + id + ']');
            $('#default_maps_level2').html(options);
          });


          $('#default_mode').hide();
          $('#play_mode').hide();
          $(':radio').change(function (event) {
            var id = $(this).data('id');
            if (id == 'default_mode') {
              $('#default_mode').show();
              $('#play_mode').hide();
            } else if (id == 'play_mode') {
              $('#default_mode').hide();
              $('#play_mode').show();
            }
          });

          </script>

          <!--Playing Section-->
          <div class = "col-sm-8">
            <label>Step 3: Start planning</label>
            <br></br>
            <form id = "gameInput">
              <div class = "form-group"> {% csrf_token %}
                <label>Risk tolerance per leg:</label>
                <input type="text" class="form-control" name="risk" id="risk" placeholder="Float Accepted ">
                <small id="riskHelp" class="form-text text-muted">Range only valid from 0 ~ 0.5 (BUT REMEMBER : risk budget is 0.02)</small>
              </div>

              <div class="form-group">
                <label>Number of steps per leg:</label>
                <input type="text" class="form-control" name="waypoints" id="waypoints" placeholder="Float Accepted ">
                <small id="waypointsHelp" class="form-text text-muted">Not Sure : Range only valid from 1 ~ 12</small>
              </div>
            <input type="submit" id = "submit" class="btn btn-primary btn-lg" value="Visualize the Path"></input>
            <button type="button" id = "decidedToGo" class="btn btn-danger btn-lg" onclick="decidedToGoClicked()">Execute</button>
          </form>

            <script>
              $(document).on('submit', '#gameInput', function(e){
                e.preventDefault();
                //console.log("sending data to backend...");
                //console.log(m2pos);
                $.ajax({
                  type : "POST",
                  url : "/game/",
                  data : {
                  risk : $('#risk').val(),
                  waypoints : $('#waypoints').val(),
                  curr_x : (submarine.x - bias) / scale,
                  curr_y : 1.0 - (submarine.y - bias) / scale,
                  obstacle_coordinates : JSON.stringify(m2pos),
                  csrfmiddlewaretoken : $('input[name=csrfmiddlewaretoken]').val(),
                },
                success : function(received_json){
                  //console.log(received_json);
                  showPlanPath(received_json['expected_route'])
                  expected_routes = received_json['expected_route'];
                  acutual_routes = received_json['real_route'];
                  //dx = received_json['dx'];
                  //dy = received_json['dy'];
                  //console.log(dx);
                  //console.log(dy);
                }
            });

            $("#submit").attr("disabled", true);
            $("#submit").val("Dont Click for 7 secs...");
            $("#changeMapinRandomMode").attr("disabled", true);
            $("#changeMapinExpMode").attr("disabled", true);
            setTimeout(function() {
              enableSubmitButton();
            }, 7000);
           });


           function enableSubmitButton() {
             $("#submit").removeAttr("disabled");
             $("#submit").val("Visualize the Path");
             $("#changeMapinRandomMode").removeAttr("disabled");
             $("#changeMapinExpMode").removeAttr("disabled");
           }


           //Button Control Attribute
           initButtonState();
           function initButtonState() {

             //step1 button:
             $("#startButton").attr("disabled", false);
             $("#startButton").html("Enter Participant ID");

             //step2 button:
             $("#changeMapinExpMode").attr("disabled", true);
             $("#default_maps_level1").attr("disabled", true);
             $("#default_maps_level2").attr("disabled", true);
             $("#changeMapinRandomMode").attr("disabled", true);
             $("#obstalce_nums").attr("disabled", true);


             //step3 button:
             $("#risk").attr("disabled", true);
             $("#waypoints").attr("disabled", true);
             $("#submit").attr("disabled", true);
             $("#decidedToGo").attr("disabled", true);
             wantDataFlag = false;
           }


           function startButtonClicked() {
             //prompt for knowing it is the experiment mode or for fun mode
             var participantID = prompt("Please Enter you Participant ID\nFor Expierment: please enter a valid ID(no validation now)\nFor Fun: please enter -1");
             if (participantID == null || participantID == "") {
               return;
             }

             //step 1 buttons deactivated
             $("#startButton").attr('disabled', true);
             $("#startButton").html(participantID);

             //step 2 buttons activated
             $("#changeMapinExpMode").attr("disabled", false);
             $("#default_maps_level1").attr("disabled", false);
             $("#default_maps_level2").attr("disabled", false);
             $("#changeMapinRandomMode").attr("disabled", false);
             $("#obstalce_nums").attr("disabled", false);

             userLogDict = initUserLogDict();
           }

           function activatePlanInputControle() {
             //game stage on
             $("#risk").removeAttr("disabled");
             $("#waypoints").removeAttr("disabled");
             $("#submit").removeAttr("disabled");
             $("#decidedToGo").removeAttr("disabled");

           }
           </script>

          </div>
        </div>
      </div>
    </div>



    <!-- Game Canvas Place -->
    <div class = "container-fluid">
    <script type="text/javascript" src="{% static "BasicApp/js/phaser.js" %}"></script>
    <style>
      body {
        padding: 0px;
        margin: 2px;
        background: #001f3f;
      }
    </style>
    <script>
      var backgroundPic_url = "{% static "BasicApp/images/colorwater.jpg" %}";
      var submarinePic_url = "{% static "BasicApp/images/submarine.png" %}";
      var finish_linePic_url = "{% static "BasicApp/images/finish_line.png" %}";
      url = "lixiao.png"
    </script>
    <script src="{% static "BasicApp/js/main.js" %}"> </script>
    <script src="{% static "BasicApp/js/map_library.js" %}"> </script>
    </div>

  </body>
</html>
